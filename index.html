<!DOCTYPE html>
<html>
  <head>
    <title>Bay Area Monitoring</title>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <style type='text/css'>
      html, body {
        width: 100%;
        height: 100%;
        min-width: 770px;
        min-height: 745px;
        margin: 0;
      }

      #page_container {
        width: 100%;
        height: 100%;
        margin: 0;
        border-spacing: 0;
        border-collapse: collapse;
      }

      #page_container tr:not(.grapher_row) {
        height: 50%;
      }

      #legend {
        border: 1px solid black;
        height: 30px;
      }

      #map_parent {
        position: relative;
      }

      .row1 {
        display:table-row;
        height: 50%;
        width: 100%;
        background: white;
      }

      .row1 div {
        display: table-cell;
        width: 100%;
      }

      .row2 {
        display: table-row;
        height: 100%;
        width: 100%;
      }

      .row2 div {
        width: 50%;
        height: 100%;
        background: transparent;
      }

      .row2 div + div {
        background: transparent;
        width: 50%;
        height: 100%;
        position: static;
        top: 0;
        right: 0;
      }

      #map-canvas {
        height: 100%;
        width: 100%;
        margin: 0;
        padding: 0;
      }

      .valueHover {
        display: none;
        z-index: 9999;
        font-size: 12pt;
        background-color: aliceblue;
        float: right;
      }

      #grapher {
        font-size: 10pt !important;
        position: relative;
        width: 100%;
        min-width: 385px;
        height: 100%;
      }

      #dateAxisContainer {
        width: 100%;
        height: 39px;
        position: relative;
      }

      #dateAxis {
        position: absolute !important;
        right: 250px;
        left: 159px;
        top: 0px;
        height: 38px;
        border: 1px solid black;
        width: 100%;
        background: white;
      }

      #radioButtonContainer {
        margin-left: auto;
        margin-right: auto;
        display: table;
      }

      .areaButton {
        margin: 5px;
      }

      .chart {
        width: 100%;
      }

      .chartTitle {
        position: absolute;
        left: 0px;
        width: 136px;
        height: 100%;
        border: 1px solid black;
        font-family: 'Helvetica Neue', Helvetica, Arial;
        color: white;
        padding: 11px
      }

      .chartContent {
        position: absolute;
        left: 159px;
        right: 35px;
        border: 1px solid black;
        background: transparent;
        width: 100%;
        height: 80px;
      }

      .healthDangerBox {
        position: absolute;
        left: 0px;
        width: 100%;
        background-color: rgb(255, 179, 179);
        z-index: -2;
      }

      .greyAreaBox {
        position: absolute;
        left: 0px;
        width: 100%;
        background-color: rgb(217, 217, 217);
        border-bottom: 0px dashed black;
        z-index: -3;
      }

      .refineryDetectionLimit {
        position: absolute;
        left: 0px;
        width: 100%;
        background-color: transparent;
        border-bottom: 2px dotted black;
        z-index: -1;
      }


      .annotationContent {
        position: absolute;
        left: 159px;
        right: 35px;
        height: 35px;
        border: 1px solid black;
        background: white;
      }

      .annotationChart {
        height: 35px;
        background: #4f5457 !important;
      }

      .annotationChartTitle {
        position: absolute;
        left: 0px;
        width: 136px;
        height: 35px;
        border: 1px solid black;
        font-family: 'Helvetica Neue', Helvetica, Arial;
        color: white;
        padding: 11px
      }

      .chartAxis {
        position: absolute !important;
        right: 0px;
        width: 34px;
        border: 1px solid black;
        background: white;
        height: 92px;
      }

      .sensorColumnTitle {
        padding-left: 12px;
        border-top: 1px solid black;
        width: 150px;
      }

      #tabs {
        border: 0px;
      }

      .ui-tabs-nav {
        border: 0px !important;
        background: #9A9A9A !important;
        border-radius: 0px !important;
        font-size: 15px !important;
        padding: 0px !important;
      }

      .ui-tabs-nav .ui-state-default {
        background: #E2E2E2 !important;
      }

      .ui-tabs-nav .ui-tabs-active {
        background: white  !important;
      }

      .ui-tabs-nav li {
        margin: 0px 0px -1px 0px !important;
        border-right: 1px solid #9C9494 !important;
        border-top: 1px solid #9C9494 !important;
        border-left: 1px solid #9C9494 !important;
      }

      #tutorialDialog {
        width: 100%;
        height: 100%;
        display: none;
        overflow: hidden;
      }

      .tutorialButton {
        position: absolute !important;
        height: 31px !important;
        top: 29px !important;
        width: 109px !important;
        left: 89px !important;
        color: white !important;
        background: rgb(215,84,90) !important;
        border: 2px solid #fff !important;
        border-radius: 1px !important;
        box-shadow: 2px 2px 3px rgba(0,0,0,0.3) !important;
        z-index: 100 !important;
        outline: none !important;
        font-family: Arial, Helvetica, sans-serif !important;
        font-size: 11px !important;
      }

      .tutorialButton .ui-icon.ui-icon-custom-tutorialButton {
        background-image: none !important;
        width: 34px !important;
        height: 34px !important;
        opacity: 0.55 !important;
        background-size: contain !important;
        margin-left: -17px !important;
        margin-top: -17px !important;
      }

      .tutorialButton .ui-button-text {
        margin-left: -14px !important;
        font-size: 15px !important;
        margin-top: 2px !important;
        line-height: 15px!important;
        text-align: left !important;
      }

      #fencelineInfo {
        width: 100%;
        height: 30px;
        text-align: center;
        margin: 0;
        padding: 0px;
        background-color:aliceblue;
      }


      .zoomGrapherBtn {
        background: rgb(150,150,150) !important;
        border-radius: 0px !important;
        outline: none;
        font-family: Arial, Helvetica, sans-serif !important;
        font-size: 11px !important;
        border: 1px solid white !important;
      }

      .zoomGrapherBtn:hover {
        background: rgb(100,100,100) !important;
      }

      #zoomGrapherIn {
        position: absolute;
        top: 1px;
        right: 8px;
        height: 19px;
        width: 17px;
      }

      #zoomGrapherOut {
        position: absolute;
        top: 20px;
        right: 8px;
        height: 19px;
        width: 17px;
      }
    </style>

    <link href="assets/timemachine-viewer/css/jquery-ui/smoothness/jquery-ui.custom.css" media="screen" rel="stylesheet" type="text/css" />
    <link href="assets/timemachine-viewer/css/defaultUI.css" media="screen" rel="stylesheet" type="text/css" />
    <link href="assets/timemachine-viewer/css/timelineMetadataVisualizer.css" rel="stylesheet" type="text/css"/>
    <link href="assets/css/application.css" media="screen" rel="stylesheet" type="text/css" />
    <link href="assets/timemachine-viewer/libs/change-detect/css/change.css" media="screen" rel="stylesheet" type="text/css" />

    <script src="assets/timemachine-viewer/js/jquery/jquery.min.js" type="text/javascript"></script>
    <script src="assets/timemachine-viewer/js/jquery/jquery-ui.custom.min.js" type="text/javascript"></script>
    <script src="assets/timemachine-viewer/js/jquery/plugins/mouse/jquery.mousewheel.min.js" type="text/javascript"></script>
    <script src="assets/timemachine-viewer/js/org/gigapan/util.js" type="text/javascript"></script>
    <script src="assets/timemachine-viewer/js/org/gigapan/timelapse/videoset.js" type="text/javascript"></script>
    <script src="assets/timemachine-viewer/js/org/gigapan/timelapse/parabolicMotion.js" type="text/javascript"></script>
    <script src="assets/timemachine-viewer/js/org/gigapan/timelapse/timelapse.js" type="text/javascript"></script>
    <script src="assets/timemachine-viewer/js/Math.uuid.js" type="text/javascript"></script>
    <script src="assets/timemachine-viewer/js/org/gigapan/timelapse/snaplapse.js" type="text/javascript"></script>
    <script src="assets/timemachine-viewer/js/org/gigapan/timelapse/snaplapseViewer.js" type="text/javascript"></script>
    <script src="assets/timemachine-viewer/js/org/gigapan/timelapse/defaultUI.js" type="text/javascript"></script>
    <script src="assets/timemachine-viewer/js/org/gigapan/timelapse/crossdomain_api.js" type="text/javascript"></script>
    <script src="assets/timemachine-viewer/js/org/gigapan/timelapse/timelineMetadataVisualizer.js" type="text/javascript"></script>
    <script src="assets/timemachine-viewer/template_includes.js" type="text/javascript"></script>

    <script src="assets/timemachine-viewer/libs/change-detect/js/ThumbnailServiceAPI.js" type="text/javascript"></script>
    <script src="assets/timemachine-viewer/libs/change-detect/js/TimeMachineCanvasLayer.js" type="text/javascript"></script>
    <script src="assets/timemachine-viewer/libs/change-detect/js/ThumbnailTool.js" type="text/javascript"></script>
    <script src="assets/timemachine-viewer/libs/change-detect/js/BoxEventHandler.js" type="text/javascript"></script>
    <script src="assets/timemachine-viewer/libs/change-detect/js/ChangeDetectionTool.js" type="text/javascript"></script>

    <script src="http://tiles.cmucreatelab.org/ecam/timemachines/shenango1/shenango1.js" type="text/javascript"></script>
    <script src="assets/js/jquery.xdomainrequest.min.js" type="text/javascript"></script>
    <script type="text/javascript" src="https://maps.googleapis.com/maps/api/js"></script>
    <script src="assets/grapher.min.js" type="text/javascript"></script>
    <script src="assets/PlotManager.js" type="text/javascript"></script>
    <script src="map.js"></script>
    <script src="smell.js"></script>
    <script src="feeds.js"></script>
    <script src="assets/data-visualization-tools/js/CanvasLayer.js"></script>

    <script>
      "use strict";
      jQuery.support.cors = true;
      var zoomify, locationDivId, timelapse, timelapseFeedUnavailable, hashVars, dateAxis;
      var pageLoadDate = cached_breathecam.latest.date;
      var today = new Date();
      cached_breathecam.latest.date = today.toISOString().substring(0,10);
      var series = [];
      var loadedSeries = [];
      var seriesIdx = 0;
      var plotManager;
      var colors = ["90,200,250","255,204,0","255,149,0", "255,45,85", "0,122,255", "76,217,100","255,59,48"];
      var area = {};
      var currentLocation = "shenango1";
      var currentDate;
      var ESDR_API_ROOT_URL = 'http://esdr.cmucreatelab.org/api/v1';
      var clampTimeout = null;
      var fixedCursorPosition;
      var tmpCount = 0;
      var grapherReady = false;
      var tmReady = false;
      var grapherLoadedInterval = null;
      var showSmokeDetection = false;
      var dateAxisListener = null;

      var feedMap = {
        "Atchison Village" : [4910, 4909],
        "North Richmond" : [4911, 4912],
        "Point Richmond" : [4913, 4914],
        "North Rodeo" : [4902, 4903],
        "South Rodeo" : [4901, 4903]
      };

      var healthLimitMap = {
        "Benzene (ppb)" : 1,
        "Hydrogen Sulfide (ppb)": 8,
        "Sulfur Dioxide (ppb)": 40,
        "Toluene (ppb)": 70,
        "Xylene (ppb)": 200,
        "Ethylbenzene (ppb)": 400
      };

      var communityDetectionLimitMap = {
        "Benzene (ppb)" : 0.5,
        "Hydrogen Sulfide (ppb)": 2,
        "Toluene (ppb)": 0.5,
        "Xylene (ppb)": 0.5,
        "Ethylbenzene (ppb)": 0.5
      };

      var refineryDetectionLimitMap = {
        "Benzene (ppb)" : 5,
        "Hydrogen Sulfide (ppb)": 30,
        "Sulfur Dioxide (ppb)": 5,
        "Toluene (ppb)": 5,
        "Xylene (ppb)": 5
      };

      var esdr_feeds = {};

      if (showSmokeDetection) {
        esdr_feeds.Smoke_Detection = {
          feed_id: 5494,
          requested_day: {},
          api_key: "22075ad630b1f674e7f1da7f3de77b5abeea89f95e9c6c8868eef6cf0cd312b1",
          channels: {
            smoke_level : {
              show_graph: true,
              graphMetaData : {
                label: "Smoke Detection",
                color: "93,93,93"
              },
              summary: {}
            }
          },
          fullTimeRange: {}
        };
      }

      function selectArea(targetArea, locale) {
        area.id = targetArea;
        if(locale === null && targetArea === "richmond") {
          area.locale = "Atchison Village";
        }
        else if (locale === null && targetArea === "crockett-rodeo") {
          area.locale = "North Rodeo";
        }
        else {
          area.locale = locale;
        }
      }

      function changeLocale(targetArea, locale) {
        selectArea(targetArea, locale);
        refreshChannelPage();
      }

      function refreshChannelPage() {
        esdr_feeds = {};
        /*esdr_feeds.Smoke_Detection = {
          feed_id: 5494,
          requested_day: {},
          api_key: "22075ad630b1f674e7f1da7f3de77b5abeea89f95e9c6c8868eef6cf0cd312b1",
          channels: {
            smoke_level : {
              show_graph: true,
              graphMetaData : {
                label: "Smoke Detection",
                color: "93,93,93"
              },
              summary: {}
            }
          },
          fullTimeRange: {}
        };*/
        plotManager.getDateAxis().removeAxisChangeListener(dateAxisListener);
        plotManager.removeAllPlotContainers();
        $("#grapher > tbody > tr").not("tr:first").remove();
        $("#legend").empty();
        var maxTimeSecs = Date.now() / 1000;
        var minTimeSecs = maxTimeSecs - 1 * 24 * 60 * 60;
        series = [];
        colors = ["90,200,250","255,204,0","255,149,0", "255,45,85", "0,122,255", "76,217,100","255,59,48"];
        loadedSeries = [];
        channelPageSetup();
      }

      function tm_init() {
        selectTimelapseFeed();

        var initialDataset = cached_breathecam.latest.path;
        var startingDate = cached_breathecam.latest.date;

        var hash = window.location.hash.slice(1);
        hashVars = org.gigapan.Util.unpackVars(hash);
        //org.gigapan.timelapse.getHomeView() = {};

        var loadedTimelapse = false;
        if (hashVars) {
          if (hashVars.d) {
            startingDate = String(hashVars.d);
            initialDataset = cached_breathecam.datasets[startingDate];
            if (!initialDataset) {
              initialDataset = cached_breathecam.latest.path;
            }
          }
          if (hashVars.s) {
            loadedTimelapse = true;
            currentLocation = String(hashVars.s);
            changeLocation(currentLocation, startingDate, null, null, false, function() {
              initialDataset = cached_breathecam.datasets[startingDate];
              if (!initialDataset) {
                initialDataset = cached_breathecam.latest.path;
              }
              setupTimelapse(initialDataset, startingDate);
            });
          }
        }

        // If we did not load the timelapse with the hash vars above, do so now.
        if (!loadedTimelapse)
          setupTimelapse(initialDataset, startingDate);
      }

      function img_init() {
        zoomify = new org.gigapan.zoomify({
          onImageReady: function(imgId) {
            showContent();
            if (!$("#timelapse_feed").is(':visible')) {
              selectImageFeed();
            }
          }
        });

        $("#stitched_image").load(function() {
          zoomify.makeImageZoomable("stitched_image");
        });

        $("#stitched_image").bind("mouseover mouseup", function() {
          $(this).removeClass("openHand closedHand").addClass("openHand");
        }).bind("mousedown", function() {
          $(this).removeClass("openHand closedHand").addClass("closedHand");
        });
      }

      function setupTimelapse(initialDataset, startingDate) {
        var settings = {
          url: initialDataset,
          disableTourLooping: true,
          mediaType: ".mp4",
          showFullScreenBtn: false,
          showLogoOnDefaultUI: false,
          datasetType: "breathecam",
          showThumbnailTool: true,
          enableTimelineMetadataVisualizer: true,
          onTimeMachinePlayerReady: function(viewerDivId) {
            tmReady = true;
            createTutorialButton(720, 540, "#timeMachine");
            if (canvasLayer)
              repaintCanvasLayer();
            if (smellCanvasLayer)
              repaintSmellCanvasLayer();
            // Time Machine Listeners
            timelapse.addTimeChangeListener(function(videoTime) {
              if (dateAxis) {
                fixedCursorPosition = Date.parse(timelapse.getCurrentCaptureTime().replace(/-/g, "/")) / 1000;
                dateAxis.setCursorPosition(fixedCursorPosition);
              }
              if (canvasLayer)
                repaintCanvasLayer();
              if (smellCanvasLayer)
                repaintSmellCanvasLayer();
            });
            // Override the hashchange event
            window.onhashchange = null;
            $(window).on("hashchange", function() {
              var newHash = window.location.hash.slice(1);
              var newHashVars = org.gigapan.Util.unpackVars(newHash);
              var currentHash = timelapse.getShareView();
              var currentHashVars = org.gigapan.Util.unpackVars(currentHash);
              window.location.hash = "";

              if (!newHashVars) return;

              if ((newHashVars.d && currentHashVars.d != newHashVars.d) || (newHashVars.s && currentHashVars.s != newHashVars.s)) {
                var newDate, newDataset;
                if (newHashVars.d) {
                  newDate = String(newHashVars.d);
                  newDataset = cached_breathecam.datasets[newDate];
                  if (!newDataset) return;
                }
                var newTime = parseFloat(newHashVars.t);
                var newView = timelapse.normalizeView(timelapse.unsafeViewToView(newHashVars.v));
                if (newHashVars.s && currentHashVars.s != newHashVars.s) {
                  currentLocation = String(newHashVars.s);
                  changeLocation(currentLocation, newDate, newView, newTime, true);
                } else {
                  updateCalendarAndToggleUI(newDate);
                  timelapse.loadTimelapse(newDataset, newView, newTime, false);
                }
              } else {
                // Share views
                timelapse.loadSharedViewFromUnsafeURL("#" + newHash);
              }
            });
            if (!hashVars) {
              var numFrames = timelapse.getNumFrames();
              // 12 fps * 5 seconds = 60 frames
              var fiveSecondsFromEnd = numFrames - 60;
              timelapse.seekToFrame(fiveSecondsFromEnd);
            }
            showContent();
            // Share view
            var hash = window.location.hash.slice(1);
            timelapse.loadSharedViewFromUnsafeURL("#" + hash);
            $("#timeMachine").hide();
            $("#locationTitle").hide();
            //$("#container").html("<div class='timelapse_hide'>Camera feed coming soon!</div>");
          }
        };
        timelapse = new org.gigapan.timelapse.Timelapse("timeMachine", settings);

        loadCalendar(startingDate);
      }

      function hideSmokeDetectionGraph() {
        $('*[data-channel="smoke_level"]').hide();
        setSizes();
      }

      function showSmokeDetectionGraph() {
        $('*[data-channel="smoke_level"]').show();
        setSizes();
      }

      function moveTimelineMetadataVisualizerUI() {
        var $target = $('*[data-channel="smoke_level"]').find('div')[0];
        $(".fastforwardButton").appendTo($target).css({
          "position" : "relative",
          "margin-top" : "2px"
        });
        $(".metadataImgsButton").appendTo($target).css({
          "position" : "relative",
          "margin-left" : "5px",
          "margin-top" : "2px"
        });
      }

      function loadMetaData(date, datasetName) {
        $.ajax({
          dataType: "json",
          url: "http://tiles.cmucreatelab.org/ecam/timemachines/smoke_detection/" + datasetName + "/smoke-" + date + ".json",
          success: function(json) {
            moveTimelineMetadataVisualizerUI();
            timelapse.getTimelineMetadataVisualizer().loadMetaData(json);
            timelapse.getTimelineMetadataVisualizer().showControlUI();
            showSmokeDetectionGraph();
          },
          error: function() {
            //timelapse.getTimelineMetadataVisualizer().hideControlUI();
            hideSmokeDetectionGraph();
          }
        });
      }

      function selectTimelapseFeed() {
        $("#image_feed").css("visibility", "hidden");
        $("#stitched_image_wrapper").css("visibility", "hidden");
        $("#stitched_image").css("visibility", "hidden");
        $("#timelapse_feed").show();
        setLocationTitle();
      }

      function selectImageFeed() {
        $("#timelapse_feed").hide();
        $("#image_feed").css("visibility", "visible");
        $("#stitched_image_wrapper").css("visibility", "visible");
        $("#stitched_image").css("visibilriity", "visible");
        $("#location_toggle_container").css("top", "0px");
        setLocationTitle();
      }

      function setLocationTitle() {
        var locationTitle = $("#location_toggle_container .location_thumbnail_selected").siblings(".location_title").text();
        $("#locationTitle").text(locationTitle);
      }

      function showContent() {
        $("#loading").hide();
        $("#content").css("visibility", "visible");
      }

      function changeLocation(locationName, newDate, newView, newTime, doLoad, callBack, newTimeAsDateObj) {
        currentLocation = locationName;
        if (timelapseFeedUnavailable) {
          location.href = "/embeds/" + locationName;
        } else {
          $.ajax({
            url: "http://tiles.cmucreatelab.org/ecam/timemachines/" + locationName + "/" + locationName + ".json",
            dataType: "json"
          }).done(function(data) {
            cached_breathecam = data;
            var startingDate = cached_breathecam.latest.date;
            var startingDataset = cached_breathecam.latest.path;

            if (newDate) {
              var tmpStartingDataset = cached_breathecam.datasets[newDate];
              if (tmpStartingDataset) {
                startingDate = newDate;
                startingDataset = tmpStartingDataset;
              }
            }
            // If there is no timelapse object at this point, then that means that we have just arrived at the page
            // with a share link that has an invalid location name.
            // Load the timelapse with the default location specified in the .fail() callback below.
            updateCalendarAndToggleUI(startingDate);
            if (!timelapse) {
              setupTimelapse(startingDataset, startingDate);
              return;
            }
            setGraphTimeRange(startingDate);
            if (doLoad) {
              if (timelapse && startingDataset) {
                newTime = parseFloat(newTime);
                timelapse.loadTimelapse(startingDataset, newView, newTime, false, newTimeAsDateObj, function() {
                  if (!newTimeAsDateObj && isNaN(newTime)) {
                    var numFrames = timelapse.getNumFrames();
                    // 12 fps * 5 seconds = 60 frames
                    var fiveSecondsFromEnd = numFrames - 60;
                    timelapse.seekToFrame(fiveSecondsFromEnd);
                  }
                });
              }
            } else if (typeof(callBack) === "function") {
              callBack();
            }
          }).fail(function(jqXHR, textStatus, errorThrown) {
            console.log(jqXHR, textStatus, errorThrown);
            changeLocation("shenango1", null, null, null, true);
          });
        }
      }

      function updateCalendarAndToggleUI(startingDate) {
        $(".gwt-PopupPanel").remove();
        locationDivId = currentLocation + "_overlay";
        setLocationThumbnailToggle();
        setLocationTitle();
        $("#datepicker").datepicker("destroy");
        loadCalendar(startingDate);
      }

      function loadCalendar(startingDate) {
        pageLoadDate = startingDate;
        currentDate = startingDate;
        var dateArray = startingDate.split("-");
        $("#datepicker").datepicker({
          defaultDate : new Date(dateArray[0], dateArray[1] - 1, dateArray[2]),
          minDate : new Date(2014, 0),
          onSelect : selectDay,
          beforeShowDay : highlightDays
        });
      }

      function highlightDays(date) {
        date = $.datepicker.formatDate('yy-mm-dd', date);
        //if (cached_breathecam.datasets[date])
          return [true, 'date-highlight'];
        //else
          //return [false, ''];
      }

      function selectDay(dateText, dateElem) {
        var date = $.datepicker.formatDate('yy-mm-dd', new Date(dateText));
        //var path = cached_breathecam.datasets[date];
        //if (timelapse && path) {
          $(".gwt-PopupPanel").remove();
          currentDate = date;
          var dayStart = setGraphTimeRange(date);
          repaintCanvasLayer(dayStart);
          //timelapse.loadTimelapse(path, null, null, true);
        //}
      }

      function setLocationThumbnailToggle() {
        $(".location_thumbnail_selected").removeClass("location_thumbnail_selected");
        $("#" + locationDivId).addClass("location_thumbnail_selected");
      }

      function getFormattedTime(date) {
        var hours = date.getHours() === 0 ? "12" : date.getHours() > 12 ? date.getHours() - 12 : date.getHours();
        var minutes = (date.getMinutes() < 10 ? "0" : "") + date.getMinutes();
        var seconds = date.getSeconds();
        var ampm = date.getHours() < 12 ? "AM" : "PM";
        var formattedTime = hours + ":" + minutes + ":" + seconds + " " + ampm;
        return formattedTime;
      }

      function requestEsdrExport(requestInfo, callBack) {
        $.ajax({
          crossDomain: true,
          type: "GET",
          dataType: "text",
          url: ESDR_API_ROOT_URL + "/feeds/" + requestInfo.feed_id + "/channels/" + requestInfo.channels + "/export",
          data: { from: requestInfo.start_time, to: requestInfo.end_time, FeedApiKey: requestInfo.api_key},
          success: function(csvData) {
            if (typeof(callBack) === "function")
              callBack(csvData);
          },
          failure: function(data) {
            console.log('Failed to load sensor data.');
          },
          headers: requestInfo.headers
        });
      }

      function parseEsdrCSV(csvData, sensor) {
        var csvArray = csvData.split("\n");
        var headingsArray = csvArray[0].split(",");
        // First row is the CSV headers, which we took care of above, so start at 1.
        for (var i = 1; i < csvArray.length; i++) {
          var csvLineAsArray = csvArray[i].split(",");
          // First entry is the EPOC time, so start at index 1.
          for (var j = 1; j < csvLineAsArray.length; j++) {
            var tmpChannelHeading = headingsArray[j].split(".");
            var channelHeading = tmpChannelHeading[tmpChannelHeading.length - 1];
            var timeStamp = sensor.channels[channelHeading].hourly ? (csvLineAsArray[0] - 1800): csvLineAsArray[0];
            sensor.channels[channelHeading].summary[timeStamp] = parseFloat(csvLineAsArray[j]);
          }
        }
      }

      function updateAreaSelectionMenu() {
        $('#radioButtonContainer').empty();
        var allLocales = Object.keys(feedMap);
        var locales = (area.id === "richmond" ? allLocales.slice(0,3) : allLocales.slice(3,5));
        $("#areaSelectionMenu").append('<form id="radioButtonContainer"></form>');
        for(var i=0;i<locales.length;i++) {
          $("#radioButtonContainer").append('<input type="radio" name="areaRadioButtonGroup"' + (i==0? 'checked="checked"' : '')
          + 'onclick="changeLocale(\'' + area.id + '\',\'' + locales[i] + '\')">' + locales[i] + '</input>');
        }
      }

      var createChart = function(feed, channelName, feedAPIKey) {
        // Setup tile source for each chart
        var datasource;
        (function(source) {
          datasource = function(level, offset, successCallback, failureCallback) {
            $.ajax({
              type: "GET",
              dataType: "json",
              url: ESDR_API_ROOT_URL + "/feeds/" + feedAPIKey + "/channels/" + source + "/tiles/" + level + "." + offset,
              success: function(json) {
                if( showSmokeDetection && channelName=="smoke_level") {
                  // Set max smoke reading value
                  var max_smoke_value = 300;
                  for (var i = 0; i < json.data.data.length; i++) {
                    if (json.data.data[i][1] > max_smoke_value) {
                      json.data.data[i][1] = max_smoke_value;
                    }
                  }
                }
                if(channelName != "smoke_level") {
                    /*json.data.data = json.data.data.filter(function(entry) {
                      return entry[1] != 0;
                    });*/
                    /*for (var i=0; i<json.data.data.length; i++) {
                      if(json.data.data[i][1] == 0) {
                        json.data.data[i][1] = -1e+308;
                      }
                    }*/
                  }
                successCallback(JSON.stringify(json.data));
              },
              failure: failureCallback
            });
          };
        })(channelName);

        // Legend
        if ($("#legend").children().length == 0) {
          if (area.id == "richmond") {
            $("#legend").append('<img src="assets/images/blue.png">Community Monitor<br><img src="assets/images/green.png">Refinery Monitor');
          }
        }


        //Zoom buttons
        if($(".ui-icon-custom-plus-white").length == 0) {
          $("#grapher").append('<button id="zoomGrapherIn" class="zoomGrapherBtn" title="Zoom in the graphs"></button>');
          $("#grapher").append('<button id="zoomGrapherOut" class="zoomGrapherBtn" title="Zoom out the graphs"></button>');
          $("#zoomGrapherIn").button({
            icons: {
              secondary: "ui-icon-custom-plus-white"
            },
            text: false
          }).on("click", function() {
            zoomGrapher(0.7);
          });
          $("#zoomGrapherOut").button({
            icons: {
              secondary: "ui-icon-custom-minus-white"
            },
            text: false
          }).on("click", function() {
            zoomGrapher(1.3);
          });
          }

        // Add charts
        var channelLabel = feed.channels[channelName].graphMetaData.label;
        var idx = loadedSeries.indexOf(channelLabel);
        var seriesIdx = series.length;
        var plotContainerId = seriesIdx + "_plot_container";
        var plotId = seriesIdx + "_plot";
        var yAxisId = seriesIdx + "_yaxis";
        if (idx != -1) {
          var tmpId = new Date().getTime();
          loadedSeries.push(channelLabel + tmpId);
          seriesIdx = idx;
          plotId = seriesIdx + "_plot" + tmpId;
          plotContainerId = seriesIdx + "_plot_container";
          yAxisId = seriesIdx + "_yaxis";
          plotManager.getPlotContainer(plotContainerId).addDataSeriesPlot(plotId, datasource, yAxisId);
        } else {
          series[seriesIdx] = {};
          series[seriesIdx].id = seriesIdx;
          series[seriesIdx].pc = [];
          loadedSeries.push(channelLabel);
          // Add chart html to page since this chart does not exist yet
          var color_fill = "rgba(" + colors.shift() + ",1)";
          var row = $('<tr class="chart grapher_row"' + 'data-channel=' + channelName + '></tr>');
          row.append('<td class="chartTitle" style="background:' + color_fill + '"><div>' + feed.channels[channelName].graphMetaData.label + '</div></td>');
          row.append('<td id="' + plotContainerId + '" class="chartContent"></td>');
          row.append('<td id="' + yAxisId + '" class="chartAxis"></td>');
          $('#grapher').append(row);

          addGraphOverlays(seriesIdx, channelLabel);

          if (showSmokeDetection && channelName == "smoke_level") {
            hideSmokeDetectionGraph();
            loadMetaData(currentDate, currentLocation);
            timelapse.addDatasetLoadedListener(function() {
              loadMetaData(currentDate, currentLocation);
            });
          }
          plotManager.addDataSeriesPlot(plotId, datasource, plotContainerId, yAxisId);
          plotManager.getYAxis(yAxisId).addAxisChangeListener(function() {
            adjustGraphOverlays(seriesIdx, channelLabel);
          });
          window.setTimeout(function() { $(window).trigger('resize'); }, 50);
        }
        var cursorColor = (feed.isDouble) ? "rgba(0,0,0,0)" : "#2A2A2A";
        var color_line = (feed.isDouble ? "rgb(0,255,0)" : "rgb(0,0,255)");
        plotManager.getPlot(plotId).addDataPointListener(function(val) {
          var valueHoverElement = $("#valueHover" + seriesIdx);
          if (val == null) {
             valueHoverElement.empty().hide();
          }
          else {
             valueHoverElement.text(val.valueString.substr(0,4)).show();
          }
       });
      plotManager.getPlot(plotId).setStyle({
        "cursor" : {
          "color" : cursorColor,
          "lineWidth" : 1
        },
        "styles": [
          { "type" : "line", "lineWidth" : 1, "show" : true, "color" : color_line },
          { "type" : "circle", radius : 1.2, "lineWidth" : 1, "show" : true, "color" : "black", fill : true }
        ],
        "highlight" : {
          "lineWidth" : 1,
          "styles" : [
             {
                "type" : "circle",
                radius : 3.5,
                "lineWidth" : 0.5,
                "show" : true,
                "color" : "#2A2A2A",
                fill : true,
                fillColor: "#2A2A2A"
             },
             {
                "show" : true,
                "type" : "value",
                "fillColor" : "#000000",
                "marginWidth" : 10,
                "font" : "12pt Helvetica,Arial,Verdana,sans-serif",
                "verticalOffset" : 5,
                "horizontalOffset" : 12,
                "numberFormat" : "###,##0.#"
             }
          ]
        }
      });
        var plotContainer = plotManager.getPlotContainer(plotContainerId);
        plotContainer.setAutoScaleEnabled(true, true);
        series[seriesIdx].pc.push(plotContainer);
      };

      function addGraphOverlays(seriesIdx, channelLabel) {
        if (healthLimitMap[channelLabel]) {
          $("#" + seriesIdx + "_plot_container").append("<div id='healthDangerBox" + seriesIdx + "' class='healthDangerBox'></div>");
        }
        if (area.id == "richmond" && communityDetectionLimitMap[channelLabel]) {
          $("#" + seriesIdx + "_plot_container").append("<div id='greyAreaBox" + seriesIdx + "' class='greyAreaBox'></div>");
        }
        if (refineryDetectionLimitMap[channelLabel]) {
          $("#" + seriesIdx + "_plot_container").append("<div id='refineryDetectionLimit" + seriesIdx + "' class='refineryDetectionLimit'></div>");
        }
        $("#" + seriesIdx + "_plot_container").append("<div id='valueHover" + seriesIdx + "' class='valueHover'></div>");
      }

      function adjustGraphOverlays(seriesIdx, channelLabel) {
        var axis = plotManager.getYAxis(seriesIdx + "_yaxis");
        //var axis = series[seriesIdx].axis;
        var chartHeight = $('.chart').height();
        var range = axis.getRange();

        var level = healthLimitMap[channelLabel];
        var overlayHeight = (range.max - level) / (range.max - range.min) * chartHeight;
        //var overlayHeight = (axis.getMax() - level) / (axis.getMax() - axis.getMin()) * chartHeight;
        $('#healthDangerBox' + seriesIdx)
            .height(overlayHeight)
            .css("max-height", chartHeight);

        level = communityDetectionLimitMap[channelLabel];
        overlayHeight = (range.max - level) / (range.max - range.min) * chartHeight;
        var borderVisible;
        overlayHeight > 2 ? borderVisible = "2px" : borderVisible = "0px";
        $('#greyAreaBox' + seriesIdx)
            .height(overlayHeight)
            .css({"max-height": chartHeight, "border-bottom-width": borderVisible});

        level = refineryDetectionLimitMap[channelLabel];
        overlayHeight = (range.max - level) / (range.max - range.min) * chartHeight;
        overlayHeight > 2 ? borderVisible = "2px" : borderVisible = "0px";
        $('#refineryDetectionLimit' + seriesIdx)
            .height(overlayHeight)
            .css({"max-height": chartHeight, "border-bottom-width": borderVisible});
      }

      function zoomGrapher(scale) {
        var min_time = plotManager.getDateAxis().getRange().min;
        var max_time = plotManager.getDateAxis().getRange().max;
        var mean_time = (max_time+min_time)/2;
        var range_half_scaled = scale*(max_time-min_time)/2;
        plotManager.getDateAxis().setRange(mean_time-range_half_scaled,mean_time+range_half_scaled);
      }

      function grapherZoomToWeek() {
        var max_time = plotManager.getDateAxis().getRange().max;
        var weekLength = 590707;
        plotManager.getDateAxis().setRange(max_time-weekLength,max_time);
      }

      function grapherZoomToDay() {
        var max_time = plotManager.getDateAxis().getRange().max;
        var weekLength = 82918;
        plotManager.getDateAxis().setRange(max_time-weekLength,max_time);
      }

      function paddedYAxisRange(min, max) {
        var yDiff = max - min;
        var padding = 0.5;
        if (yDiff < 1e-10) {
          padding = 0.5;
        } else {
          padding = 0.05 * yDiff;
        }
        return {min : min - padding, max : max + padding};
      }

      function setSizes(channelLabel) {
        $('.chartContent').height($('.chart').height() - 1);
        $('.chartTitle').height($('.chart').height() - 23);
        $('.chartAxis').height($('.chart').height() - 1);
        google.maps.event.trigger(map, 'resize');

        return;
        var width = $(window).width() / 2;
        var height = $(window).height() / 2;
        if (!dateAxis) return;
        //$("#grapher").css({"width" : width + "px", "height" : height + "px"});
        $("#dateAxis").width($('.chartContent').width());
        var dateAxisWidth = $('#dateAxis').width();
        var dateAxisHeight = 38;
        $('.chartContent').height(100 - 1);
        $('.chartTitle').height(100 - 23);
        $('.chartAxis').height(100 - 1);
        if (!dateAxisWidth || !dateAxisHeight) return;
        dateAxis.setSize(dateAxisWidth, dateAxisHeight, SequenceNumber.getNext());
        for (var i = 0; i < series.length; i++) {
          var newHeight = $('.chart').height();
          // if (i === 0)
          //   newHeight = $('.annotationContent').height();
          if (series[i].axis)
            series[i].axis.setSize($('#series' + i + 'axis').width(), newHeight, SequenceNumber.getNext());
          if(channelLabel) {
            adjustGraphOverlays(i, channelLabel);
          }
          if (series[i].pc)
            series[i].pc.setSize($('#series' + i).width(), newHeight, SequenceNumber.getNext());
        }
      }

      function setGraphTimeRange(date) {
        var axis = plotManager.getDateAxis();
        if (!axis) return;
        var dayStartString = date + " 00:00:00";
        var dayEndString = date + " 23:59:59";
        var dayStart = (new Date((dayStartString).replace(/-/g,"/")).getTime()) / 1000;
        var dayEnd = (new Date((dayEndString).replace(/-/g,"/")).getTime()) / 1000;
        axis.setRange(dayStart, dayEnd);
        return dayStart;
      }

      function initialize() {
        $( "#tabs" ).tabs({
          heightStyle: "content",
          activate: function(event, ui) {
            if ($(ui.newPanel)[0].id == "tabs-2") {
              selectArea($(ui.newTab)[0].id, null);
              updateAreaSelectionMenu();
              $("body, html").css("overflow", "hidden");
              if (!timelapse) {
                channelPageSetup();
              } else {
                refreshChannelPage();
              }
              google.maps.event.trigger(map, 'resize');
            } else {
              $("body, html").css("overflow", "auto");
              // Hack for Chrome when switching tabs:
              // Gifs stop animating unless the page changes size
              if (tmpCount % 2 === 0)
                $("#google-doc").width("99.9%");
              else
                $("#google-doc").width("100%");
              tmpCount++;
            }
          }
        });
        if (window.location.hash.indexOf("#v=") > -1)
          $( "#tabs" ).tabs( "option", "active", 1 );
      }

      window.grapherLoad = function() {
        var maxTimeSecs = Date.now() / 1000;
        var minTimeSecs = maxTimeSecs - 1 * 24 * 60 * 60;
        plotManager = new org.bodytrack.grapher.PlotManager("dateAxis", minTimeSecs, maxTimeSecs);
        plotManager.getDateAxis().addAxisChangeListener(dateAxisListener);
        $(window).resize(function() {
          setSizes();
        });
        plotManager.setWillAutoResizeWidth(true, function() {
          return $("#grapher").width() - 34 - 136 - 26;
        });
        grapherReady = true;
      };

      $(initialize);

      function createTutorialButton(buttonWidth, buttonHeight, appendingDiv) {
        var $tutorialButton = $("<div class='tutorialButton'>Quick Tour</div>");
        $tutorialButton.attr({"id" : "timeMachine_tutorialButton", "title" : "Watch an instructional video on how to use Shenango Channel"});
        $tutorialButton.button({
          icons: {
            primary: "ui-icon-custom-tutorialButton"
          },
          text: true
        }).on("click", function() {
          var $tourDialog = $("#tutorialDialog");
          if ($tourDialog.dialog("isOpen")) {
            $tourDialog.dialog("close");
            $("#tutorialIframe").remove();
          } else {
            $("#tutorialDialog").append('<iframe id="tutorialIframe" src="//player.vimeo.com/video/140196813?autoplay=1" width="100%" height="100%" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe>');
            $tourDialog.dialog("open");
          }
        });
        $tutorialButton.appendTo($(appendingDiv));

        $("#tutorialDialog").dialog({
          resizable: false,
          autoOpen: false,
          dialogClass: "customDialog",
          width: buttonWidth,
          height: buttonHeight,
          modal: true,
          open: function( event, ui ) {
            $(this).parent().css("top", "0px");
            $(".ui-widget-overlay").on('click', function(){
              $("#tutorialDialog").dialog('close');
            });
          },
          close: function( event, ui ) {
            $("#tutorialIframe").remove();
          }
        });
      }

      function initFeeds() {
        var feedNames = Object.keys(esdr_feeds).sort();
        if(showSmokeDetection) {
          feedNames.splice(feedNames.indexOf("Smoke_Detection"), 1);
          feedNames[feedNames.length] = "Smoke_Detection";
        }
        for (var i = 0; i < feedNames.length; i++) {
          (function(i){
            $.ajax({
              type: "GET",
              dataType: "json",
              url: ESDR_API_ROOT_URL + '/feeds/' + esdr_feeds[feedNames[i]].api_key,
              success: function(json) {
                esdr_feeds[feedNames[i]].fullTimeRange.min = json.data.minTimeSecs;
                esdr_feeds[feedNames[i]].fullTimeRange.max = json.data.maxTimeSecs;
                if (i == feedNames.length - 1) {
                  for (var j = 0; j < feedNames.length; j++) {
                    (function(j){
                      var feed = esdr_feeds[feedNames[j]];
                      var channelNames = Object.keys(feed.channels);
                      channelNames.forEach(function(channelName) {
                        if (!feed.channels[channelName].show_graph) return;
                        createChart(feed, channelName, feed.api_key);
                      });
                    })(j);
                  }
                }
              }
            });
          })(i);
        }
        if (canvasLayer)
          repaintCanvasLayer();
      }

      function channelPageSetup() {
        if (!tmReady) {
          // Initialize E-Cam
          var timelapseSupported = org.gigapan.Util.browserSupported();
          var stitchedImage = "N/A";
          locationDivId = "shenango1" + "_overlay";
          setLocationThumbnailToggle();
          $(".location_thumbnail_container").on("click", function() {
            if (window.location.hash)
              window.location.hash = "";
            var newLocation = $(this).attr("data-location-id");
            if (timelapse)
              var captureTimeAsDateObj = new Date(timelapse.getCurrentCaptureTime().replace(/-/g,"/"));
            changeLocation(newLocation, currentDate, null, null, true, null, captureTimeAsDateObj);
          });
          if ((!timelapseSupported || typeof (cached_breathecam) === "undefined") && stitchedImage === "") {
            // Nothing is up. Hide containers and inform the user
            $("#stitched_image_wrapper").hide();
            $("#location_toggle_container").hide();
            $("#loading").html("<div class='error_msg2'>Content currently unavailable. Please try again later.</div>");
          }
          /** else if (!timelapseSupported || typeof (cached_breathecam) === "undefined") {
            timelapseFeedUnavailable = true;
            // TODO: Image feed is not working since the-shenango-channel currently does not have a way to get the latest image,
            // unlike when it was running on the Rails server.
            // Timelapse unavailable, show latest stitched pano
            // Calendar is gone in this mode, so move thumbnail toggles to top of page
            //$("#location_toggle").css({'top':'0px'});
            //$("#image_feed_timestamp").css({"top" : "48px", "right" : "22px"});
            //img_init();
            $("#stitched_image_wrapper").hide();
            $("#location_toggle_container").hide();
            $("#timelapse_feed").hide();
            $("#grapher").hide();
            $("#map-canvas").hide();
            $("#tutorialDialog").hide();
            $("#loading").html("<div class='error_msg2'>Shenango Channel is not available on mobile devices. Please use a desktop or laptop when viewing this site.</div>");
          } */
          else {
            // Show timelapse
            tm_init();
          }
        }


        // Initialize Map
        initMap('map-canvas');

        grapherLoadedInterval = window.setInterval(function() {
          if (!grapherReady) return;

          window.clearInterval(grapherLoadedInterval);
          grapherLoadedInterval = null;

          // Initialize Smells
          initSmells();

          // Initialize Graphs
          loadFeeds(feedMap[area.locale]);

        }, 10);
      }

      window.requestAnim =
        window.requestAnimationFrame ||
        window.webkitRequestAnimationFrame ||
        window.mozRequestAnimationFrame ||
        window.oRequestAnimationFrame ||
        window.msRequestAnimationFrame ||
        function(callback) {
          return window.setTimeout(callback, 10);
        };

    </script>
  </head>
  <body style="height: 100%">
    <div id="tabs" style="width: 100%; height: 100%; margin: 0; padding: 0px; position: absolute;">
      <ul>
        <li><a href="#tabs-1" style="outline:0;">Introduction</a></li>
        <li id="richmond"><a href="#tabs-2" style="outline:0;">Richmond</a></li>
        <li id="crockett-rodeo"><a href="#tabs-2" style="outline:0;">Crockett-Rodeo</a></li>
      </ul>
      <div id="tabs-1" style="width: 100%; padding: 0px; margin: 0;">
        <div style="text-align: center">
        <h1>Welcome to the Bay Area Air Monitoring Hub</h1>
        <h3>To view our source of real-time air quality data, please visit
          <a href="http://www.fenceline.org">fenceline.org</a></h3>
        <p>Please note that this website is a prototype and may contain bugs. If you discover one, please describe it
          here: </p>
          <form action="index.php" method="POST">
            <fieldset>
              <textarea rows="9" cols="50" name="message"></textarea><br/>
              <input type="submit" value="Submit" onclick="alert('Thanks for your feedback!')">
            </fieldset>
        </form>
        </div>
        <?php
          $log_file_name = 'bug_log.log';
          $message = $_POST['message'];
          $time_label = date("Y-m-d",time());
          $entry = $time_label . " " . $message . "\n";
          file_put_contents($log_file_name, $entry, FILE_APPEND);
          debug_to_console($entry);
          header('Location: index.php');
        ?>
        <br>
        <div style="border: 2px solid black; padding-left: 20px;">
        <h2><u>What's New</u></h2>
        <strong>8/5/16</strong>
        <p>The bug reporting form is up and running.</p><hr>
        <strong>7/29/16</strong>
        <p>Zooming in and zooming out on the graphs can now be done using a pinching or mouse scrolling. Additionally, the issue with the browser freezing up is fixed.</p><hr>
        <strong>7/15/16</strong>
        <p>Wind speed can now be viewed by hovering over the monitor location on the map.</p>
        </div>
      </div>
      <div id="tabs-2" style="width: 100%; height: 100%; margin: 0; padding: 0px">
        <div id="areaSelectionMenu" style="width: 100%; height: 25px; margin: 0; padding: 0px; background-color:aliceblue"></div>
        <div id="foo" style="height: calc(100% - 80px)">
          <div id="container" style="height:32%">
            <div id="loading">
              <img id="loadingImg" src="assets/images/loading.gif" width="358" height="250" alt="loading">
            </div>
            <div id="tutorialDialog" title="A Tour for the Shenango Channel"></div>
            <div id="locationTitle" class="no-select"></div>
            <div id="timelapse_feed" class="timelapse_feed_embed">
              <div id="timeMachine"></div>
              <div id="timeFrame">
                <button onclick="grapherZoomToWeek()">Last 7 Days</button>
                <button onclick="grapherZoomToDay()">Last 24 Hours</button>
              </div>
              <div id="datepicker" class="datepicker_embed no-select"></div>
            </div>
            <div id="image_feed" class="image_feed_embed no-select">
              <div id="stitched_image_wrapper" class="image-zoom-wrapper image-zoom-wrapper-embed">
                <div id="zoom-in" title="Zoom in"><p>+</p></div>
                <div id="zoom-out" title="Zoom out"><p>_</p></div>
                <img id="stitched_image" class="image-zoom" src="#" alt="Latest Stitch">
                <span id="image_feed_timestamp">03/09/2015 03:16 PM</span>
              </div>
            </div>
            <!--<div id="location_toggle_container" class="no-select">
              <a class="location_thumbnail_container" data-location-id="shenango1" href="javascript:void(0)">
                <div id="shenango1_overlay" class="location_thumbnail_overlay"></div>
                <img src="assets/images/shenango1.png" class="location_thumbnail" alt="Shenango1">
                <div class="location_title"> </div>
              </a>
              <a class="location_thumbnail_container location_thumbnail_container_end" data-location-id="shenango2" href="javascript:void(0)">
                <div id="shenango2_overlay" class="location_thumbnail_overlay"></div>
                <img src="assets/images/shenango2.png" class="location_thumbnail" alt="Shenango2">
                <div class="location_title"> </div>
              </a>
            </div> -->
          </div>
          <div id="grapher_parent" style="width:50%; height:68%; float: left">
            <table id="grapher" border="0" cellspacing="0" cellpadding="0">
              <tr id="dateAxisContainer" class="grapher_row">
                <td id="legend" class="sensorColumnTitle"></td><td id="dateAxis"></td><td></td>
              </tr>
            </table>
          </div>
          <div id="map_parent" style="width:50%; height:68%; float: right">
            <div id="map-canvas"></div>
            <div id="wind_speed"></div>
        </div>
          </div>
          <div id="fencelineInfo">To view our source of real-time air quality data, please visit
            <a href="http://www.fenceline.org">fenceline.org</a></div>
      </div>
    </div>
    <div style="font-family: Custom-Calibri;">.</div>
  </body>
</html>
